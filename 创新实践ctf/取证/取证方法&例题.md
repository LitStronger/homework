- 下载volatility
- 用DumpIt工具（是内存副本获取工具）生成主机的物理内存镜像。副本文件是以*.raw为后缀的镜像文件，取证的对象就是这个内存镜像

#### 使用：

(1)常用命令：imageinfo、kpcrscan、dlllist、filescan、handles、modscan、netscan、pslist、pstree。

- Imageinfo命令：用于查看我们正在分析的内存样本的摘要信息

- kpcrscan命令：用于查找内存中用于定义内核处理器控制区域（KPCR）的_KPCR结构体信息

- dlllist命令：能够显示一个进程装载的动态链接库的信息，其显示列表主要包括加载的动态链接库文件的基地址、文件大小以及文件所在路径。

- filescan命令：此命令将显示系统上的打开的文件，包括已被恶意软件隐藏的文件。

- handles命令：显示在一个进程中打开的处理。

- modscan命令：扫描_ldr_data_table_entry对象的物理内存。显示内核的驱动程序，包括已隐藏/链接的。

- netscan命令：发现TCP / UDP端点和监听器。这个命令将显示一个主动网络连接的列表。

- pslist命令：可以枚举系统中的进程，这条命令通过遍历PsActiveProcessHead指针指向的双向链表枚举当前内存中活跃的所有进程信息，主要包括偏移地址、进程ID号、父进程ID号、线程数量、句柄数量、进程会话ID号以及进程开始和退出的时间。

- pstree命令：这个命令显示跟pslist一样的信息，只是以树的形式。



### 一、volatility使用

#####  例题文件

链接: <http://pan.baidu.com/s/1c2BIGLE> 

密码: 9v2z

```
volatility -f <文件名> –profile=<配置文件> <插件> [插件参数] 
```

(1)使用imageinfo插件来猜测dump文件的profile值：WinXPSP2x86 

```
# volatility -f mem.vmem imageinfo
```

![1587038349361](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587038349361.png)

(2)得到profile值后可使用插件volshell执行shell命令

```
# volatility -f mem.vmem –profile=WinXPSP2x86
```

![1587038849580](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587038849580.png)

##### shell的命令

```
dt("内核关键数据结构名称")
```

如

```
dt("_PEB")
```

![1587039015147](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587039015147.png)

##### pslist列举进程

```
# volatility -f mem.vmem –profile=WinXPSP2x86 pslist
```

![1587039247283](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587039247283.png)

##### 列举缓存在内存的注册表

```
volatility -f mem.vmem –profile=WinXPSP2x86 hivelist
```

![1587039333915](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587039333915.png)

##### hivedump打印出注册表中的数据 ：

```
volatility -f mem.vmem –profile=WinXPSP2x86 hivedump -o <注册表的virtual地址>
```

![1587039525393](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587039525393.png)

##### 获取SAM表中的用户：

![1587040182324](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587040182324.png)

![1587040221010](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587040221010.png)

![1587040249961](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587040249961.png)



```
# volatility -f mem.vmem –profile=WinXPSP2x86 printkey -K "SAM\Domains\Account\Users\Names"
```

可以看到有4个用户

![1587039986343](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587039986343.png)

##### 获取最后登录系统的账户 ：

```
# volatility -f mem.vmem –profile=WinXPSP2x86 printkey -K "SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon"
```

##### 提取出内存记录（当时正在运行的程序，运行次数，最后一次运行的时间

```
# volatility -f mem.vmem –profile=WinXPSP2x86 userassist
```

![1587041070461](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587041070461.png)

##### 以dmp格式dump出某个进程数据

```
# volatility -f mem.vmem –profile=WinXPSP2x86 -p [PID] -D [dump出的文件保存的目录]
```

![1587041604992](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587041604992.png)

### 二、解题步骤

```
# volatility -f mem.vmem –profile=WinXPSP2x86 pslist
```

![1587042393716](C:/Users/啦啦啦/AppData/Roaming/Typora/typora-user-images/1587042393716.png)

最后一个进程TrueCrypy.exe是一款加密程序，可以推出，另一个文件suspicion为加密的结果。将进程从内存dump出来。 

```
volatility -f mem.vmem –profile=WinXPSP2x86 memdump -p 1464 -D ./data 
```

得到dmp文件后，需要借助Elcomsoft Forensic Disk Decryptor（Elcomsoft硬盘取证解密器，简称为EFDD）软件来获取key和破解文件

![01.png](https://image.3001.net/images/20171031/15094375557380.png!small)

![02.png](https://image.3001.net/images/20171031/15094375765357.png!small)

![03.png](https://image.3001.net/images/20171031/15094375849827.png!small)

![03.png](https://image.3001.net/images/20171031/15094375849827.png!small)

![04.png](https://image.3001.net/images/20171031/1509437591953.png!small)

![05.png](https://image.3001.net/images/20171031/15094375988759.png!small)

![06.png](https://image.3001.net/images/20171031/15094376135906.png!small)  

![07.png](https://image.3001.net/images/20171031/15094376201424.png!small)

![08.png](https://image.3001.net/images/20171031/15094376269633.png!small)

![09.png](https://image.3001.net/images/20171031/15094376338276.png!small)